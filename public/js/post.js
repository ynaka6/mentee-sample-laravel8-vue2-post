(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{YITw:function(t,e,r){"use strict";r.r(e);var s=r("o0o1"),n=r.n(s),a=r("vDqi"),o=r.n(a),i=r("Z0ar"),c=r("df64"),l=r("rZh2"),u=r("IyC2"),p=r("A/pN"),f=r("DIvk"),m=r("t7Eb"),d=r("pyMF"),h=r("aIz9");function g(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,s)}return r}function v(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?g(Object(r),!0).forEach((function(e){w(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function w(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function x(t,e,r,s,n,a,o){try{var i=t[a](o),c=i.value}catch(t){return void r(t)}i.done?e(c):Promise.resolve(c).then(s,n)}function b(t){return function(){var e=this,r=arguments;return new Promise((function(s,n){var a=t.apply(e,r);function o(t){x(a,s,n,o,i,"next",t)}function i(t){x(a,s,n,o,i,"throw",t)}o(void 0)}))}}var C={components:{AppButton:i.a,AppModal:c.a,AppTitle:l.a,AppTextarea:u.a,ExternalSiteCard:p.a,PostCard:f.a,PostCardList:m.a,PostImageList:d.a,TextLengthCounter:h.a},data:function(){return{postId:this.$route.params.id,post:null,form:{message:null,images:[]},externalSite:null}},computed:{loggedIn:function(){return this.$store.getters["auth/loggedIn"]},comments:function(){return this.$store.getters["post/comments"]},nextComment:function(){return this.$store.getters["post/nextComment"]}},watch:{$route:function(t,e){var r=this;return b(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.postId=t.params.id,e.next=3,r.fetchPost();case 3:return r.post=e.sent,e.next=6,r.fetchComments({reset:!0});case 6:case"end":return e.stop()}}),e)})))()}},created:function(){var t=this;return b(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.fetchPost();case 3:return t.post=e.sent,e.next=6,t.fetchComments({reset:!0});case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0.response,t.$parent.$parent.template="error";case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()},methods:{fetchPost:function(){return this.$store.dispatch("post/fetchPost",{id:this.postId})},fetchComments:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$store.dispatch("post/fetchComments",v(v({},t),{},{parentId:this.postId}))},formState:function(t){return this.errors&&this.errors[t]&&0<this.errors[t].length?this.errors[t][0]:""},previewImages:function(t){var e=this;if(this.form.images=[],t.target.files.length>4)return alert("画像は4つまでアップロードすることが可能です。"),void(this.$refs.file.value=null);Array.from(t.target.files).forEach((function(t){var r=new FileReader;r.onload=function(t){e.form.images.push(t.target.result)},r.readAsDataURL(t)}))},clearImages:function(){this.$refs.file.value=null,this.form.images=[]},onSubmit:function(){var t=this;return b(n.a.mark((function e(){var r,s,a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.loggedIn){e.next=2;break}return e.abrupt("return");case 2:return(r=new FormData).append("parentId",t.postId),t.form.message&&r.append("message",t.form.message),t.isStore&&(r.append("product[price]",t.form.product.price),r.append("product[payment_count]",t.form.product.payment_count||"")),Array.from(t.$refs.file.files).forEach((function(t,e){r.append("images["+e+"]",t)})),e.prev=7,e.next=10,t.$store.dispatch("post/createComment",r);case 10:t.form.message=null,t.externalSite=null,t.form.images=[],t.$refs.file.value=null,t.$refs.commentModal.hide(),e.next=22;break;case 17:e.prev=17,e.t0=e.catch(7),s=e.t0.response,(a=s.data.errors)&&(t.errors=a);case 22:case"end":return e.stop()}}),e,null,[[7,17]])})))()},likePost:function(t){this.loggedIn?t.liking?o.a.delete("/api/post/".concat(t.id,"/unlike")).then((function(e){t.liking=!1,t.likesCount=e.data.count})):o.a.post("/api/post/".concat(t.id,"/like")).then((function(e){t.liking=!0,t.likesCount=e.data.count})):confirm("いいねするにはログインが必要です")&&this.$router.push("/login")},deletePost:function(t){var e=this;return b(n.a.mark((function r(){return n.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.$store.dispatch("post/deletePost",t);case 2:e.$router.push("/");case 3:case"end":return r.stop()}}),r)})))()},checkoutPost:function(t){this.loggedIn||confirm("商品を購入するにはログインが必要です")&&this.$router.push("/login")}}},k=r("KHd+"),y=Object(k.a)(C,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.post?r("div",{staticClass:"h-full flex justify-center"},[r("div",{staticClass:"w-full"},[r("div",{staticClass:"flex items-center bg-gray-900 p-4 mb-2"},[r("router-link",{staticClass:"text-white mr-2",attrs:{to:"/"}},[r("font-awesome-icon",{staticClass:"mr-4",attrs:{icon:["fas","arrow-left"],size:"lg"}})],1),t._v(" "),r("div",[r("app-title",{staticClass:"text-white",attrs:{title:t.post.user.name+"の投稿"}})],1)],1),t._v(" "),t.post?r("post-card",{staticClass:"mb-2",attrs:{post:t.post,detail:!0,"handle-like-post":t.likePost,"handle-delete-post":t.deletePost,"handle-checkout-post":t.checkoutPost}}):t._e(),t._v(" "),r("div",{staticClass:"my-6"},[r("div",{staticClass:"w-full bg-white rounded-full shadow-xl text-gray-600 text-sm p-4 cursor-pointer",on:{click:function(e){return e.preventDefault(),t.$refs.commentModal.show()}}},[r("font-awesome-icon",{staticClass:"mr-1",attrs:{icon:["fas","comments"],size:"lg"}}),t._v("\n                コメントを投稿する\n            ")],1)]),t._v(" "),t.comments?r("post-card-list",{attrs:{posts:t.comments,next:!!t.nextComment,"handle-fetch-post":t.fetchComments,"handle-like-post":t.likePost,"handle-delete-post":t.deletePost,"handle-checkout-post":t.checkoutPost}}):t._e()],1),t._v(" "),r("portal",{attrs:{to:"modal"}},[r("app-modal",{ref:"commentModal"},[r("form",{staticClass:"mb-8",on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[r("app-textarea",{attrs:{error:t.formState("message"),disabled:!t.loggedIn},model:{value:t.form.message,callback:function(e){t.$set(t.form,"message",e)},expression:"form.message"}}),t._v(" "),r("div",{staticClass:"w-full flex justify-between items-center mb-2"},[r("div",{staticClass:"w-1/2"},[t.loggedIn?r("a",{staticClass:"text-gray-800 opacity-75",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.$refs.file.click()}}},[r("font-awesome-icon",{attrs:{icon:["far","images"]}})],1):t._e(),t._v(" "),r("input",{ref:"file",staticClass:"w-0 opacity-0",attrs:{type:"file",multiple:""},on:{change:t.previewImages}})]),t._v(" "),r("div",{staticClass:"w-1/2 text-right"},[r("text-length-counter",{attrs:{text:t.form.message}})],1)]),t._v(" "),t.form.images.length?r("post-image-list",{staticClass:"mb-1",attrs:{images:t.form.images}}):t._e(),t._v(" "),t.form.images.length?r("div",{staticClass:"mb-2"},[t.form.images.length?r("a",{staticClass:"font-bold text-red-500 text-xs",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.clearImages(e)}}},[r("font-awesome-icon",{staticClass:"mr-1",attrs:{icon:["far","trash-alt"]}}),t._v("\n                        画像を全て削除する\n                    ")],1):t._e()]):t._e(),t._v(" "),t.externalSite?r("external-site-card",{attrs:{title:t.externalSite.title,description:t.externalSite.description,image:t.externalSite.image,url:t.externalSite.url}}):t._e(),t._v(" "),r("app-button",{staticClass:"w-full",attrs:{"tag-name":"button",type:"submit",size:"lg",rounded:"sm",disabled:!t.loggedIn}},[t._v("\n                    コメントを投稿する\n                ")])],1)])],1)],1):t._e()}),[],!1,null,null,null);e.default=y.exports}}]);