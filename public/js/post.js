(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{YITw:function(t,e,n){"use strict";n.r(e);var r=n("o0o1"),s=n.n(r),o=n("vDqi"),a=n.n(o),i=n("df64"),l=n("rZh2"),c=n("DIvk"),u=n("t7Eb"),m=n("Z0ar"),f={components:{AppButton:m.a}},p=n("KHd+"),d=Object(p.a)(f,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"flex flex-col items-center justify-center"},[e("div",{staticClass:"mx-auto mb-4 flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 text-red-500 sm:mx-0 sm:h-10 sm:w-10"},[e("font-awesome-icon",{attrs:{icon:["fas","exclamation-triangle"]}})],1),this._v(" "),this._m(0),this._v(" "),e("app-button",{attrs:{"tag-name":"router-link",to:"/login",size:"lg",rounded:"full"}},[this._v("\n        ログイン\n    ")])],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"w-full p-4 text-center mb-4"},[e("p",{staticClass:"font-semibold text-xl mb-2"},[this._v("ログインが必要になります")]),this._v(" "),e("p",{staticClass:"text-sm text-gray-600 mb-2"},[this._v("ログイン画面からログインしてください。")])])}],!1,null,null,null).exports,h=n("IyC2"),g=n("A/pN"),v=n("pyMF"),x=n("aIz9");function w(t,e,n,r,s,o,a){try{var i=t[o](a),l=i.value}catch(t){return void n(t)}i.done?e(l):Promise.resolve(l).then(r,s)}var b={components:{AppButton:m.a,AppTextarea:h.a,ExternalSiteCard:g.a,PostImageList:v.a,TextLengthCounter:x.a},props:{postId:{type:Number,require:!0,default:0},loggedIn:{type:Boolean,require:!1,default:!1},handlePostedComment:{type:Function,require:!0,default:function(){}}},data:function(){return{form:{message:null,images:[]},externalSite:null}},methods:{formState:function(t){return this.errors&&this.errors[t]&&0<this.errors[t].length?this.errors[t][0]:""},previewImages:function(t){var e=this;if(this.form.images=[],t.target.files.length>4)return alert("画像は4つまでアップロードすることが可能です。"),void(this.$refs.file.value=null);Array.from(t.target.files).forEach((function(t){var n=new FileReader;n.onload=function(t){e.form.images.push(t.target.result)},n.readAsDataURL(t)}))},clearImages:function(){this.$refs.file.value=null,this.form.images=[]},onSubmit:function(){var t,e=this;return(t=s.a.mark((function t(){var n,r,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.loggedIn){t.next=2;break}return t.abrupt("return");case 2:return(n=new FormData).append("parentId",e.postId),e.form.message&&n.append("message",e.form.message),e.isStore&&(n.append("product[price]",e.form.product.price),n.append("product[payment_count]",e.form.product.payment_count||"")),Array.from(e.$refs.file.files).forEach((function(t,e){n.append("images["+e+"]",t)})),t.prev=7,t.next=10,e.$store.dispatch("post/createComment",n);case 10:e.form.message=null,e.externalSite=null,e.form.images=[],e.$refs.file.value=null,e.handlePostedComment(),t.next=22;break;case 17:t.prev=17,t.t0=t.catch(7),r=t.t0.response,(o=r.data.errors)&&(e.errors=o);case 22:case"end":return t.stop()}}),t,null,[[7,17]])})),function(){var e=this,n=arguments;return new Promise((function(r,s){var o=t.apply(e,n);function a(t){w(o,r,s,a,i,"next",t)}function i(t){w(o,r,s,a,i,"throw",t)}a(void 0)}))})()}}},C=Object(p.a)(b,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("form",{on:{submit:function(e){return e.preventDefault(),t.onSubmit(t.form)}}},[n("app-textarea",{attrs:{error:t.formState("message"),disabled:!t.loggedIn},model:{value:t.form.message,callback:function(e){t.$set(t.form,"message",e)},expression:"form.message"}}),t._v(" "),n("div",{staticClass:"w-full flex justify-between items-center mb-2"},[n("div",{staticClass:"w-1/2"},[t.loggedIn?n("a",{staticClass:"text-gray-800 opacity-75",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.$refs.file.click()}}},[n("font-awesome-icon",{attrs:{icon:["far","images"]}})],1):t._e(),t._v(" "),n("input",{ref:"file",staticClass:"w-0 opacity-0",attrs:{type:"file",multiple:""},on:{change:t.previewImages}})]),t._v(" "),n("div",{staticClass:"w-1/2 text-right"},[n("text-length-counter",{attrs:{text:t.form.message}})],1)]),t._v(" "),t.form.images.length?n("post-image-list",{staticClass:"mb-1",attrs:{images:t.form.images}}):t._e(),t._v(" "),t.form.images.length?n("div",{staticClass:"mb-2"},[t.form.images.length?n("a",{staticClass:"font-bold text-red-500 text-xs",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.clearImages(e)}}},[n("font-awesome-icon",{staticClass:"mr-1",attrs:{icon:["far","trash-alt"]}}),t._v("\n            画像を全て削除する\n        ")],1):t._e()]):t._e(),t._v(" "),t.externalSite?n("external-site-card",{attrs:{title:t.externalSite.title,description:t.externalSite.description,image:t.externalSite.image,url:t.externalSite.url}}):t._e(),t._v(" "),n("app-button",{staticClass:"w-full",attrs:{"tag-name":"button",type:"submit",size:"lg",rounded:"sm",disabled:!t.loggedIn}},[t._v("\n        コメントを投稿する\n    ")])],1)}),[],!1,null,null,null).exports;function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){y(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function P(t,e,n,r,s,o,a){try{var i=t[o](a),l=i.value}catch(t){return void n(t)}i.done?e(l):Promise.resolve(l).then(r,s)}function I(t){return function(){var e=this,n=arguments;return new Promise((function(r,s){var o=t.apply(e,n);function a(t){P(o,r,s,a,i,"next",t)}function i(t){P(o,r,s,a,i,"throw",t)}a(void 0)}))}}var $={components:{AppModal:i.a,AppTitle:l.a,PostCard:c.a,PostCardList:u.a,LoginWarningItem:d,PostCommentForm:C},data:function(){return{postId:this.$route.params.id,post:null,form:{message:null,images:[]},externalSite:null}},computed:{loggedIn:function(){return this.$store.getters["auth/loggedIn"]},comments:function(){return this.$store.getters["post/comments"]},nextComment:function(){return this.$store.getters["post/nextComment"]}},watch:{$route:function(t,e){var n=this;return I(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.postId=t.params.id,e.next=3,n.fetchPost();case 3:return n.post=e.sent,e.next=6,n.fetchComments({reset:!0});case 6:case"end":return e.stop()}}),e)})))()}},created:function(){var t=this;return I(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.fetchPost();case 3:return t.post=e.sent,e.next=6,t.fetchComments({reset:!0});case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0.response,t.$parent.$parent.template="error";case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()},methods:{fetchPost:function(){return this.$store.dispatch("post/fetchPost",{id:this.postId})},fetchComments:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$store.dispatch("post/fetchComments",k(k({},t),{},{parentId:this.postId}))},onClickPostComment:function(){this.loggedIn?this.$refs.commentModal.show():this.$refs.loginWarningModal.show&&this.$refs.loginWarningModal.show()},likePost:function(t){this.loggedIn?t.liking?a.a.delete("/api/post/".concat(t.id,"/unlike")).then((function(e){t.liking=!1,t.likesCount=e.data.count})):a.a.post("/api/post/".concat(t.id,"/like")).then((function(e){t.liking=!0,t.likesCount=e.data.count})):confirm("いいねするにはログインが必要です")&&this.$router.push("/login")},deletePost:function(t){var e=this;return I(s.a.mark((function n(){return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.$store.dispatch("post/deletePost",t);case 2:e.$router.push("/");case 3:case"end":return n.stop()}}),n)})))()},checkoutPost:function(t){this.loggedIn||confirm("商品を購入するにはログインが必要です")&&this.$router.push("/login")}}},O=Object(p.a)($,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.post?n("div",{staticClass:"h-full flex justify-center"},[n("div",{staticClass:"w-full"},[n("div",{staticClass:"flex items-center bg-gray-900 p-4 mb-2"},[n("router-link",{staticClass:"text-white mr-2",attrs:{to:"/"}},[n("font-awesome-icon",{staticClass:"mr-4",attrs:{icon:["fas","arrow-left"],size:"lg"}})],1),t._v(" "),n("div",[n("app-title",{staticClass:"text-white",attrs:{title:t.post.user.name+"の投稿"}})],1)],1),t._v(" "),t.post?n("post-card",{staticClass:"mb-2",attrs:{post:t.post,detail:!0,"handle-like-post":t.likePost,"handle-delete-post":t.deletePost,"handle-checkout-post":t.checkoutPost}}):t._e(),t._v(" "),n("div",{staticClass:"my-6"},[n("div",{staticClass:"w-full bg-white rounded-full shadow-xl text-gray-600 text-sm p-4 cursor-pointer",on:{click:function(e){return e.preventDefault(),t.onClickPostComment(e)}}},[n("font-awesome-icon",{staticClass:"mr-1",attrs:{icon:["fas","comments"],size:"lg"}}),t._v("\n                コメントを投稿する\n            ")],1)]),t._v(" "),t.comments?n("post-card-list",{attrs:{posts:t.comments,next:!!t.nextComment,"handle-fetch-post":t.fetchComments,"handle-like-post":t.likePost,"handle-delete-post":t.deletePost,"handle-checkout-post":t.checkoutPost}}):t._e()],1),t._v(" "),n("portal",{attrs:{to:"modal"}},[n("app-modal",{ref:"commentModal"},[n("post-comment-form",{attrs:{"post-id":t.postId,"logged-in":t.loggedIn,"handle-posted-comment":function(){return t.$refs.commentModal.hide()}}})],1),t._v(" "),n("app-modal",{ref:"loginWarningModal"},[n("login-warning-item")],1)],1)],1):t._e()}),[],!1,null,null,null);e.default=O.exports}}]);